# BarlowTwins Configuration
# Reference: Zbontar et al. 2021 "Barlow Twins: Self-Supervised Learning via Redundancy Reduction"

barlow:
  encoder: resnet18            # ResNet18 ~4x faster than ResNet50; sufficient for homogeneous chest X-rays
  proj_dim: 2048               # Keep large projector — BarlowTwins quality scales with proj_dim
  proj_hidden_dim: 2048        # Projector hidden width
  lambda_coeff: 0.005          # Off-diagonal weight — 0.005 from paper, lower = more invariance

training:
  run_name: barlow-resnet50-cloud
  batch_size: 512              # grad checkpointing reduces activation mem ~5x, 512 fits easily
  lr: 2.4e-3                   # Linear scale from local: 3e-4 × (512/64) = 2.4e-3
  weight_decay: 1.0e-4
  epochs: 200                  # ResNet18 converges faster; 200 sufficient vs ResNet50's 300
  warmup_epochs: 10
  grad_clip: 3.0
  checkpoint_every: 25
  output_dir: outputs/barlow

data:
  image_size: 224
  num_workers: 4               # cache_in_ram=True: no disk I/O, fewer workers needed to avoid shm exhaustion
  cache_in_ram: true
  datasets:
    - name: nih
      root_dir: datasets/nih-chest-xrays
      # txt_file omitted — use all 112k images for pretraining

augmentations:
  random_crop_scale: [0.08, 1.0]
  rotation_degrees: 10
  color_jitter_prob: 0.8
  color_jitter_brightness: 0.8
  color_jitter_contrast: 0.8
  gaussian_blur_prob: 0.5
  gaussian_blur_kernel: 23
  gaussian_noise_std: 0.1      # simulates X-ray quantum (Poisson) noise
