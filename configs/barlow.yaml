# BarlowTwins Configuration
# Reference: Zbontar et al. 2021 "Barlow Twins: Self-Supervised Learning via Redundancy Reduction"

barlow:
  encoder: resnet50
  proj_dim: 2048               # Full-size projector for cloud run (512 for local with bs=64)
  proj_hidden_dim: 2048        # Projector hidden width
  lambda_coeff: 0.005          # Off-diagonal weight — 0.005 from paper, lower = more invariance

training:
  run_name: barlow-resnet50-cloud
  batch_size: 512              # L4 22GB: no momentum encoder, fits 512 (MoCo needed 384 due to queue)
  lr: 2.0e-3                   # Linear scale from local: 3e-4 × (512/64) = 2.4e-3, rounded down
  weight_decay: 1.0e-4
  epochs: 300
  warmup_epochs: 10
  grad_clip: 3.0
  checkpoint_every: 25
  output_dir: outputs/barlow

data:
  image_size: 224
  num_workers: 14              # 16 vCPUs — leave 2 for main process + OS
  cache_in_ram: true
  datasets:
    - name: nih
      root_dir: datasets/nih-chest-xrays
      # txt_file omitted — use all 112k images for pretraining

augmentations:
  random_crop_scale: [0.08, 1.0]
  rotation_degrees: 10
  color_jitter_prob: 0.8
  color_jitter_brightness: 0.8
  color_jitter_contrast: 0.8
  gaussian_blur_prob: 0.5
  gaussian_blur_kernel: 23
  gaussian_noise_std: 0.1      # simulates X-ray quantum (Poisson) noise
